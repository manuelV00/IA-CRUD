<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Autor</title>
    <style>
        /* CSS B谩sico (Simulando el CSS Suministrado) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #eef1f5; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,.1); }
        h2, h3 { text-align: center; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #34495e; }
        .form-group input[type="text"] { width: 100%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 6px; box-sizing: border-box; transition: border-color .3s; }
        .form-group input[type="text"]:focus { border-color: #3498db; outline: none; }
        .button-group { display: flex; gap: 15px; justify-content: center; margin-top: 20px; }
        .button-group button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; transition: background-color .3s, transform .1s; }
        .button-group button:hover { transform: translateY(-2px); }
        .button-create { background-color: #2ecc71; }
        .button-update { background-color: #f39c12; }
        .button-delete { background-color: #e74c3c; }
        .button-list { background-color: #3498db; }
        .table-container { margin-top: 40px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ecf0f1; padding: 12px; text-align: left; }
        th { background-color: #2c3e50; color: white; }
        tbody tr:nth-child(even) { background-color: #f8f9fa; }
        tbody tr:hover { background-color: #e0f7fa; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h2> Gesti贸n de Autores (CRUD)</h2>

        <form id="autorForm" method="POST" action="/api/autor">
            <p>Utilice este formulario para crear, actualizar o eliminar un autor.</p>
            
            <input type="hidden" id="id" name="id" value="" placeholder="ID del autor"> 

            <div class="form-group">
                <label for="nombre">Nombre del Autor (*)</label>
                <input type="text" id="nombre" name="nombre" placeholder="Ej: Gabriel Garc铆a M谩rquez" maxlength="100" required>
            </div>

            <div class="form-group">
                <label for="nacionalidad">Nacionalidad</label>
                <input type="text" id="nacionalidad" name="nacionalidad" placeholder="Ej: Colombiana" maxlength="50">
            </div>

            <div class="button-group">
                <button type="submit" class="button-create" onclick="this.form.action='/api/autor/create';">Crear</button>
                <button type="submit" class="button-update" onclick="this.form.action='/api/autor/update';">Actualizar</button>
                <button type="submit" class="button-delete" onclick="this.form.action='/api/autor/delete';">Eliminar</button>
                <button type="reset" class="button-list" style="background-color: #95a5a6;">Limpiar Formulario</button>
            </div>
        </form>

        <hr>

        <div class="table-container">
            <h3> Listado de Autores Existentes</h3>
            <p>Esta tabla representa la vista de los registros almacenados en la base de datos.</p>
            
            <div class="button-group" style="justify-content: flex-start;">
                <button class="button-list" onclick="alert('L贸gica para obtener y mostrar la lista de autores...');">Actualizar Lista</button>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Nacionalidad</th>
                        <th>Fecha Creaci贸n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Gabriel Garc铆a M谩rquez</td>
                        <td>Colombiana</td>
                        <td>2024-01-15 10:30:00</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Isabel Allende</td>
                        <td>Chilena</td>
                        <td>2024-02-20 12:45:00</td>
                    </tr>
                    </tbody>
            </table>
        </div>

    </div>
<script>
    // ======== CAMBIO NECESARIO: usar URL relativa al backend desplegado ========
    const BASE = '/api/autores';

    document.getElementById('autorForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        // Qu茅 bot贸n envi贸 el formulario
        const btn = document.activeElement;

        // Datos comunes
        const id = (document.getElementById('id').value || '').trim();
        const nombre = document.getElementById('nombre').value.trim();
        const nacionalidad = document.getElementById('nacionalidad').value.trim();

        let url = BASE;
        let method = 'POST';
        let body = null;

        if (btn && btn.classList.contains('button-create')) {
            // CREATE
            if (!nombre) return alert('El nombre es obligatorio para crear.');
            method = 'POST';
            url = BASE;
            body = JSON.stringify({ nombre, nacionalidad });
        } else if (btn && btn.classList.contains('button-update')) {
            // UPDATE
            if (!id) return alert('Debe indicar el ID para actualizar.');
            if (!nombre) return alert('El nombre es obligatorio para actualizar.');
            method = 'PUT';
            url = `${BASE}/${id}`;
            body = JSON.stringify({ nombre, nacionalidad });
        } else if (btn && btn.classList.contains('button-delete')) {
            // DELETE
            if (!id) return alert('Debe indicar el ID para eliminar.');
            if (!confirm(`驴Eliminar el autor con ID ${id}?`)) return;
            method = 'DELETE';
            url = `${BASE}/${id}`;
            body = null; // sin cuerpo para DELETE
        } else {
            // por defecto: crear
            if (!nombre) return alert('El nombre es obligatorio para crear.');
            method = 'POST';
            url = BASE;
            body = JSON.stringify({ nombre, nacionalidad });
        }

        try {
            const resp = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body
            });

            const data = await resp.json().catch(() => ({}));

            if (!resp.ok) {
                const msg = data.mensaje || data.error || `Error ${resp.status}`;
                return alert(`Operaci贸n fallida: ${msg}`);
            }

            if (method === 'POST') {
                alert(`Autor creado con 茅xito. ID: ${data.id ?? '(desconocido)'}`);
            } else if (method === 'PUT') {
                alert('Autor actualizado exitosamente.');
            } else if (method === 'DELETE') {
                alert('Autor eliminado exitosamente.');
            }

            // Reset ligero tras 茅xito
            this.reset();
            document.getElementById('id').value = '';

        } catch (e) {
            console.error(e);
            alert('No se pudo conectar al servidor API.');
        }
    });
</script>
</body>
</html>
